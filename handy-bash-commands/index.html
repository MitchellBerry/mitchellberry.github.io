<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang="en">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">





















  
  
  
  

  
    
    
  

  

  

  

  
    
      
    

    
  

  
    
    
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic|Hack:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext">
  






<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.1.1">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.1.1">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=7.1.1">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico?v=7.1.1">


  <link rel="mask-icon" href="/images/logo.svg?v=7.1.1" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '7.1.1',
    sidebar: {"position":"left","display":"hide","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="A random collection of (possibly) useful shell commands. Contents Copy only certain filetypes List all open ports Replace words in text files Get user info Wipe all iptables rules Drop all ipv6 connec">
<meta name="keywords" content="shell,linux,sysadmin">
<meta property="og:type" content="article">
<meta property="og:title" content="Handy Bash Commands">
<meta property="og:url" content="mitchellberry.github.io/handy-bash-commands/index.html">
<meta property="og:site_name" content="Cybernated">
<meta property="og:description" content="A random collection of (possibly) useful shell commands. Contents Copy only certain filetypes List all open ports Replace words in text files Get user info Wipe all iptables rules Drop all ipv6 connec">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2019-05-04T07:09:20.313Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Handy Bash Commands">
<meta name="twitter:description" content="A random collection of (possibly) useful shell commands. Contents Copy only certain filetypes List all open ports Replace words in text files Get user info Wipe all iptables rules Drop all ipv6 connec">





  
  
  <link rel="canonical" href="mitchellberry.github.io/handy-bash-commands/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Handy Bash Commands | Cybernated</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Cybernated</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>Tags</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>Categories</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>

  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="mitchellberry.github.io/handy-bash-commands/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mitchell Berry">
      <meta itemprop="description" content="An assortment of digital tidbits.">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Cybernated">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Handy Bash Commands

              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: June-2018 14:08:40" itemprop="dateCreated datePublished" datetime="2018-06-02T14:08:40+10:00">June-2018</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>A random collection of (possibly) useful shell commands.</p>
<h5 id="Contents"><a href="#Contents" class="headerlink" title="Contents"></a>Contents</h5><ul>
<li><a href="#copy-filetype">Copy only certain filetypes</a></li>
<li><a href="#list-ports">List all open ports</a></li>
<li><a href="#word-replace">Replace words in text files</a></li>
<li><a href="#user-info">Get user info</a></li>
<li><a href="#flush-iptable">Wipe all iptables rules</a></li>
<li><a href="#deny-ipv6">Drop all ipv6 connections</a></li>
<li><a href="#webserver-iptables">Webserver iptables setup</a></li>
<li><a href="#no-logs">Disable system logging</a></li>
<li><a href="#sudo-time">Modify sudo timeout</a></li>
<li><a href="#host-name">Change hostname</a></li>
</ul>
<a id="more"></a>

<br>
<a name="copy-filetype">
##### Find and copy only certain file type
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">find -iname <span class="string">'*.mp3'</span> -<span class="built_in">exec</span> cp &#123;&#125; /home/mb/music \;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>-iname ‘*.mp3’ – Search for files matching with extension .mp3</p>
</li>
<li><p>-exec cp – Tells you to execute the ‘cp’ command to copy files from source to destination directory.</p>
</li>
<li><p>{} – is automatically replaced with the file name of the files found by ‘find’ command.</p>
</li>
<li><p>/home/mb/music/ – Target directory to save the matching files.</p>
</li>
<li><p>; – Indicates it that the commands to be executed are now complete, and to carry out the command again on the next match.</p>
</li>
</ul>
<br>
<a name="list-ports">
##### List all open ports
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">netstat -lntup</span><br></pre></td></tr></table></figure>

<ul>
<li>-l only services which are listening on some port</li>
<li>-n show port number, don’t try to resolve the service name</li>
<li>-t tcp ports</li>
<li>-u udp ports</li>
<li>-p name of the program</li>
</ul>
<br>
<a name="word-replace">
##### Replace words in text files (Sed)
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Search for all words TEXT in file /tmp/foo and change line in place to NEWTEXT</span></span><br><span class="line">sed -i <span class="string">'/TEXT/c\NEWTEXT'</span> /tmp/foo</span><br><span class="line"><span class="comment"># Change word on particular line</span></span><br><span class="line">sed -i <span class="string">'27s/TEXT/NEWTEXT/'</span> /tmp/foo</span><br></pre></td></tr></table></figure>

<br>
<a name="diff-user">
##### Run command as different user
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Requires root</span></span><br><span class="line">runuser -l mitchell -c <span class="string">"whoami"</span></span><br></pre></td></tr></table></figure>

<br>
<a name="user=info">
##### Get user info (groups/uid/gid) 
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">id janitor</span><br></pre></td></tr></table></figure>

<br>
<a name="flush-iptable">
##### Wipe clean iptables, accept all
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">iptables -P INPUT ACCEPT &amp;&amp;</span><br><span class="line">iptables -P FORWARD ACCEPT &amp;&amp;</span><br><span class="line">iptables -P OUTPUT ACCEPT &amp;&amp;</span><br><span class="line">iptables -t nat -F &amp;&amp;</span><br><span class="line">iptables -t mangle -F &amp;&amp;</span><br><span class="line">iptables -F &amp;&amp;</span><br><span class="line">iptables -X &amp;&amp;</span><br><span class="line">ip6tables -P INPUT ACCEPT &amp;&amp;</span><br><span class="line">ip6tables -P FORWARD ACCEPT &amp;&amp;</span><br><span class="line">ip6tables -P OUTPUT ACCEPT &amp;&amp;</span><br><span class="line">ip6tables -t nat -F &amp;&amp;</span><br><span class="line">ip6tables -t mangle -F &amp;&amp;</span><br><span class="line">ip6tables -F &amp;&amp;</span><br><span class="line">ip6tables -X</span><br></pre></td></tr></table></figure>

<br>
<a name="deny-ipv6">
##### Drop all ipv6 connections
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ip6tables -P INPUT DROP &amp;&amp;</span><br><span class="line">ip6tables -P FORWARD DROP &amp;&amp;</span><br><span class="line">ip6tables -P OUTPUT DROP</span><br></pre></td></tr></table></figure>

<br>
<a name="webserver-iptables">
##### Webserver iptables setup (Uses a custom ssh port)

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># The loopback interface, also referred to as lo, is what a computer uses to forward network connections to itself.</span></span><br><span class="line"><span class="comment"># also used if you configure your application server to connect to a database server with a "localhost" address</span></span><br><span class="line">iptables -A INPUT -i lo -j ACCEPT &amp;&amp;</span><br><span class="line">iptables -A OUTPUT -o lo -j ACCEPT &amp;&amp;</span><br><span class="line"></span><br><span class="line"><span class="comment"># create a firewall rule that allows established and related incoming traffic, so that the server will allow return traffic to outgoing connections initiated by the server itself</span></span><br><span class="line">iptables -A INPUT -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT &amp;&amp;</span><br><span class="line"></span><br><span class="line"><span class="comment"># allow outgoing traffic of all established connections, which are typically the response to legitimate incoming connections</span></span><br><span class="line">iptables -A OUTPUT -m conntrack --ctstate ESTABLISHED -j ACCEPT &amp;&amp;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Some network traffic packets get marked as invalid. Sometimes it can be useful to log this type of packet but often it is fine to drop them. </span></span><br><span class="line">iptables -A INPUT -m conntrack --ctstate INVALID -j DROP &amp;&amp;</span><br><span class="line"></span><br><span class="line"><span class="comment"># SSH Custom port</span></span><br><span class="line">iptables -A INPUT -p tcp --dport 2444 -m conntrack --ctstate NEW,ESTABLISHED -j ACCEPT &amp;&amp;</span><br><span class="line"><span class="comment"># only necessary if the OUTPUT policy is not set to ACCEPT</span></span><br><span class="line">iptables -A OUTPUT -p tcp --sport 2444 -m conntrack --ctstate ESTABLISHED -j ACCEPT &amp;&amp;</span><br><span class="line"></span><br><span class="line"><span class="comment"># allow both HTTP and HTTPS traffic</span></span><br><span class="line">iptables -A INPUT -p tcp -m multiport --dports 80,443 -m conntrack --ctstate NEW,ESTABLISHED -j ACCEPT &amp;&amp;</span><br><span class="line">iptables -A OUTPUT -p tcp -m multiport --sports 80,443 -m conntrack --ctstate ESTABLISHED -j ACCEPT &amp;&amp;</span><br><span class="line"></span><br><span class="line"><span class="comment"># drop the rest, ignoring forwarding</span></span><br><span class="line">iptables -P INPUT DROP &amp;&amp;</span><br><span class="line"></span><br><span class="line"><span class="comment"># basic file for backup</span></span><br><span class="line">iptables-save &gt; ~/ruleset-v4 &amp;&amp;</span><br><span class="line">ip6tables-save &gt; ~/ruleset-v6 &amp;&amp;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"### iptables setup complete ###"</span></span><br></pre></td></tr></table></figure>

<br>
<a name="no-logs">
##### Disable system logging
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">service rsyslog stop</span><br><span class="line">systemctl <span class="built_in">disable</span> rsyslog</span><br></pre></td></tr></table></figure>

<br> 
<a name="download-unzip">
##### Download and unzip file one liner
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"Please enter url"</span>;</span><br><span class="line">url = input()</span><br></pre></td></tr></table></figure>

<br> 
<a name="sudo-time">
Time is in minutes. Use "-1" for infinite or "0" for never.
DO NOT modify the file any other way besides using visudo.
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo visudo</span><br><span class="line"><span class="comment"># append to file</span></span><br><span class="line">Defaults:USER timestamp_timeout=30</span><br></pre></td></tr></table></figure>

<br> 
<a name="host-name">
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo hostname &lt;new-server-name-here&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># edit the /etc/hostname file and update hostname:</span></span><br><span class="line">sudo nano /etc/hostname</span><br><span class="line"></span><br><span class="line"><span class="comment"># edit the /etc/hosts file and update the lines that reads your old-host-name:</span></span><br><span class="line">sudo nano /etc/hosts</span><br></pre></td></tr></table></figure>

</a></a></a></a></a></a></a></a></a></a></a></a>
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/shell/" rel="tag"># shell</a>
          
            <a href="/tags/linux/" rel="tag"># linux</a>
          
            <a href="/tags/sysadmin/" rel="tag"># sysadmin</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/docker-basics/" rel="next" title="Docker Basics">
                <i class="fa fa-chevron-left"></i> Docker Basics
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/porting-c-codebases-to-rust/" rel="prev" title="Porting C Codebases to Rust">
                Porting C Codebases to Rust <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Mitchell Berry</p>
              <div class="site-description motion-element" itemprop="description">An assortment of digital tidbits.</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">27</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">9</span>
                    <span class="site-state-item-name">categories</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">46</span>
                    <span class="site-state-item-name">tags</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          

          

          
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-5"><a class="nav-link" href="#Contents"><span class="nav-number">1.</span> <span class="nav-text">Contents</span></a></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Mitchell Berry</span>

  

  
</div>









        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/utils.js?v=7.1.1"></script>

  <script src="/js/motion.js?v=7.1.1"></script>



  
  


  <script src="/js/schemes/muse.js?v=7.1.1"></script>



  
  <script src="/js/scrollspy.js?v=7.1.1"></script>
<script src="/js/post-details.js?v=7.1.1"></script>

<script>
    $('.highlight').prepend($('<button>').addClass('copy-btn')
        .append("Copy").on('click', function(e) {
        console.log(e);
        var code = $(e.target).parent().find('.code').find('.line').map(function(i, e){
        return $(e).text()
      }).toArray().join('\n')
      e.currentTarget.textContent = 'Copied!';
      revertButton(e, 5000);
      var ta = document.createElement('textarea')
      document.body.appendChild(ta)
      ta.style.position = 'fixed'
      ta.style.top = 0
      ta.style.left = 0
      ta.value = code
      ta.select()
      ta.focus()
      document.execCommand('copy')
      document.body.removeChild(ta)

    }))
    function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
    }
    async function revertButton(e, time){
        await sleep(time);
        e.currentTarget.textContent = 'Copy';
    }
</script>


  


  <script src="/js/next-boot.js?v=7.1.1"></script>


  

  

  

  


  


  




  

  

  

  

  

  

  

  

  

  

  

  

  

  

</body>
</html>
